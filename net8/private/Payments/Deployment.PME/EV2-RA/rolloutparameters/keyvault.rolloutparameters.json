{
  "$schema": "http://schema.express.azure.com/schemas/2015-01-01-alpha/RolloutParameters.json",
  "contentVersion": "1.0.0.0",
  "extensions": [
    {
      "name": "setprivateissuer",
      "type": "Microsoft.KeyVault.DataPlane/SetCertificateIssuer",
      "version": "2020-03-01",
      "connectionProperties": {
        "maxExecutionTime": "PT20M",
        "authentication": {
          "type": "AadApplicationAuthentication",
          "reference": {
            "provider": "AzureKeyVault",
            "parameters": {
              "secretId": "https://__DEPLOYMENT_IDENTITY_KV_NAME__.vault.azure.net/secrets/__DEPLOYMENT_IDENTITY_KV_CERTIFICATE_NAME__"
            }
          },
          "properties": {
            "applicationId": "__DEPLOYMENT_IDENTITY_APP_ID__"
          }
        }
      },
      "payloadProperties": {
        "vaultBaseUrl": {
          "value": "https://kv-__WORKLOAD_NAME__-__SHORT_LOCATION__-__STAMP__.vault.azure.net"
        },
        "issuerName": {
          "value": "__CERTIFICATE_PRIVATE_PROVIDER__"
        },
        "provider": {
          "value": "__CERTIFICATE_PRIVATE_PROVIDER__"
        }
      }
    },
    {
      "name": "setpublicissuer",
      "type": "Microsoft.KeyVault.DataPlane/SetCertificateIssuer",
      "version": "2020-03-01",
      "connectionProperties": {
        "maxExecutionTime": "PT20M",
        "authentication": {
          "type": "AadApplicationAuthentication",
          "reference": {
            "provider": "AzureKeyVault",
            "parameters": {
              "secretId": "https://__DEPLOYMENT_IDENTITY_KV_NAME__.vault.azure.net/secrets/__DEPLOYMENT_IDENTITY_KV_CERTIFICATE_NAME__"
            }
          },
          "properties": {
            "applicationId": "__DEPLOYMENT_IDENTITY_APP_ID__"
          }
        }
      },
      "payloadProperties": {
        "vaultBaseUrl": {
          "value": "https://kv-__WORKLOAD_NAME__-__SHORT_LOCATION__-__STAMP__.vault.azure.net"
        },
        "issuerName": {
          "value": "__CERTIFICATE_PUBLIC_PROVIDER__"
        },
        "provider": {
          "value": "__CERTIFICATE_PUBLIC_PROVIDER__"
        }
      }
    },
    {
      "name": "createcert",
      "type": "Microsoft.KeyVault.DataPlane/CreateCertificate",
      "version": "2020-03-01",
      "connectionProperties": {
        "maxExecutionTime": "PT20M",
        "authentication": {
          "type": "AadApplicationAuthentication",
          "reference": {
            "provider": "AzureKeyVault",
            "parameters": {
              "secretId": "https://__DEPLOYMENT_IDENTITY_KV_NAME__.vault.azure.net/secrets/__DEPLOYMENT_IDENTITY_KV_CERTIFICATE_NAME__"
            }
          },
          "properties": {
            "applicationId": "__DEPLOYMENT_IDENTITY_APP_ID__"
          }
        }
      },
      "payloadProperties": {
        "vaultBaseUrl": {
          "value": "https://kv-__WORKLOAD_NAME__-__SHORT_LOCATION__-__STAMP__.vault.azure.net"
        },
        "certificateName": {
          "value": "__CERTIFICATE_CERT_NAME__"
        },
        "policy": {
          "value": "{\"key_props\":{\"exportable\":true,\"kty\":\"RSA\",\"key_size\":2048},\"secret_props\":{\"contentType\":\"application/x-pkcs12\"},\"x509_props\":{\"subject\":\"CN=__CERTIFICATE_SUBJECT_NAME__\",\"sans\":{\"dns_names\":__CERTIFICATE_DNS_NAMES__},\"validity_months\":6},\"lifetime_actions\":[{\"trigger\":{\"days_before_expiry\":95},\"action\":{\"action_type\":\"AutoRenew\"}}],\"issuer\":{\"name\":\"__CERTIFICATE_ISSUER_PROVIDER__\"}}"
        },
        "forceNewVersion": {
          "value": "false"
        }
      }
    }
  ]
}