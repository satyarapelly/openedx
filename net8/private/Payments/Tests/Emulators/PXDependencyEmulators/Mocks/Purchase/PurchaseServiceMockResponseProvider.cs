// <copyright file="PurchaseServiceMockResponseProvider.cs" company="Microsoft">Copyright (c) Microsoft. All rights reserved.</copyright>

namespace Microsoft.Commerce.Payments.Tests.Emulators.PXDependencyEmulators.Mocks
{
    using System;
    using System.Collections.Generic;
    using System.Collections.Specialized;
    using System.IO;
    using System.Linq;
    using System.Net;
    using System.Net.Http;
    using System.Threading.Tasks;
    using Newtonsoft.Json;
    using Test.Common;
    using global::Tests.Common.Model.PurchaseService;

    public class PurchaseServiceMockResponseProvider : IMockResponseProvider
    {
        private const string PUIDNextLink = "1055518870507445";

        public PurchaseServiceMockResponseProvider()
        {
            var mockCheckPiResultJson = File.ReadAllText(
                Path.Combine(
                    AppDomain.CurrentDomain.BaseDirectory,
                    "Mocks",
                    "Purchase",
                    "CheckPiResults.json"));

            MockCheckPiResults = JsonConvert.DeserializeObject<List<MockCheckPiResult>>(
                mockCheckPiResultJson);

            var subscriptionsJson = File.ReadAllText(
                Path.Combine(
                    AppDomain.CurrentDomain.BaseDirectory,
                    "Mocks",
                    "Purchase",
                    "Subscriptions.json"));

            Subscriptions = JsonConvert.DeserializeObject<List<Subscription>>(
                subscriptionsJson);

            var ordersJson = File.ReadAllText(
                Path.Combine(
                    AppDomain.CurrentDomain.BaseDirectory,
                    "Mocks",
                    "Purchase",
                    "Orders.json"));

            Orders = JsonConvert.DeserializeObject<List<Order>>(
                ordersJson);
        }

        public static List<MockCheckPiResult> MockCheckPiResults { get; private set; }

        public static List<Subscription> Subscriptions { get; private set; }

        public static List<Order> Orders { get; private set; }

        public void ResetDefaults()
        {
        }

        public async Task<HttpResponseMessage> GetMatchedMockResponse(HttpRequestMessage request)
        {
            var trimmedSegments = request.RequestUri.Segments.Select(s => s.Trim(new char[] { '/' })).ToArray();

            string responseContent = null;
            HttpStatusCode statusCode = HttpStatusCode.OK;
            if (request.RequestUri.ToString().IndexOf("msa:PuidOfNewUser") > 0)
            {
                if (request.RequestUri.ToString().Contains("orders"))
                {
                    responseContent = "{\"items\":[]}";
                }
                else if (request.RequestUri.ToString().Contains("recurrences"))
                {
                    responseContent = "{\"items\":[]}";
                }
            }
            else if (request.RequestUri.ToString().IndexOf(PUIDNextLink) > 0)
            {
                //// special user for continuation tests 
                if (request.RequestUri.ToString().Contains("orders"))
                {
                    if (request.RequestUri.ToString().IndexOf("continuationToken") > 0)
                    {
                        responseContent = "{\"items\":[{\"bundlePrices\":[],\"clientContext\":{\"client\":\"UniversalWebStore.Cart\",\"deviceId\":\"6966500065365589\",\"deviceType\":\"Unknown\"},\"createdTime\":\"2019-10-18T01:11:34.4875638+00:00\",\"currencyCode\":null,\"displayTotalFeeAmount\":null,\"friendlyName\":\"cart-save-for-later-US\",\"isInManualReview\":false,\"isPIRequired\":false,\"RequiresPIValidation\":\"NotRequired\",\"isUpdatePIAllowed\":false,\"language\":\"en-US\",\"manualReviewRiskDecision\":\"None\",\"market\":\"US\",\"omniChannelFulfillmentId\":\"\",\"orderAdditionalMetadata\":\"{}\",\"orderId\":\"007b3d5d-18a1-4ce8-a2f7-57a8d89c4336\",\"orderLineItems\":[],\"orderState\":\"Editing\",\"orderValidityEndTime\":\"2019-10-19T01:11:34.4875638+00:00\",\"orderValidityStartTime\":\"2019-10-18T01:11:34.4875638+00:00\",\"promoCodes\":[],\"purchaser\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"riskSessionId\":\"90d00e75-6bc6-4d6f-bea4-b9c99a4e1b13\",\"shortOrderId\":\"3611975540\",\"taxDetails\":[],\"testScenarios\":\"TestUser\",\"totalAmount\":0.0,\"totalAmountBeforeTax\":0.0,\"totalAmusementTax\":0.0,\"totalChargedToCsvTopOffPI\":0.0,\"totalItemAmount\":0.0,\"totalSalesTax\":0.0,\"totalTaxAmount\":0.0,\"version\":\"7.0\"},{\"billingInformation\":{\"billingRecordId\":\"17c63d81-472d-40f4-b8bb-f614ca890cbd\",\"billingRecordVersion\":0,\"paymentInstrumentId\":\"lchqggAAAAABAACA\",\"sessionId\":\"77e926f3-1757-4015-95fa-707bfb87fe35\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"taxInfoReference\":\"00000000-0000-0000-0000-000000000000\",\"tokenizedPaymentInstrumentData\":\"\"},\"bundlePrices\":[],\"clientContext\":{\"client\":\"UniversalWebStore\",\"deviceFamily\":\"Web\",\"deviceId\":\"6966500065365589\",\"deviceType\":\"Unknown\"},\"createdTime\":\"2019-10-18T01:09:43.3804258+00:00\",\"currencyCode\":\"USD\",\"displayTotalFeeAmount\":0.0,\"isInManualReview\":false,\"isPIRequired\":true,\"RequiresPIValidation\":\"NotRequired\",\"isUpdatePIAllowed\":false,\"language\":\"en-us\",\"manualReviewRiskDecision\":\"None\",\"market\":\"US\",\"omniChannelFulfillmentId\":\"\",\"orderId\":\"2c1bcc81-9d16-4473-8549-13302c38f132\",\"orderLineItems\":[{\"availabilityId\":\"CFQ7TTC0J7FM\",\"beneficiary\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"billingState\":\"Charged\",\"currencyCode\":\"USD\",\"description\":\"Xbox Live Gold 1 Month\",\"fulfillmentDate\":\"2019-10-18T01:10:02.1161486+00:00\",\"fulfillmentState\":\"Fulfilled\",\"isPIRequired\":true,\"isTaxIncluded\":false,\"lineItemId\":\"83a30054-9860-48a4-8952-da76d88d1fda\",\"listPrice\":9.99,\"fulfillmentStates\":[{\"cancelable\":true,\"canceled\":false,\"fulfillmentQuantityId\":\"27ae8af2-caae-4551-85b3-fe8564d8a7c1\",\"fulfillmentReturnType\":0,\"fulfillmentState\":\"Fulfilled\",\"refundJustifications\":[]}],\"billingStates\":[{\"startIndex\":0,\"endIndex\":0,\"billingState\":\"Charged\",\"totalChargedAmount\":10.99,\"totalRefundedAmount\":0.0,\"totalRefundedTaxAmount\":0.0,\"totalRefundedFeeAmount\":0.0,\"totalRefundedFeeTaxAmount\":0.0}],\"fulfillmentBillingStates\":[{\"billingState\":\"Charged\",\"count\":1,\"fulfillmentState\":\"Fulfilled\"}],\"parentalApprovalState\":\"None\",\"payments\":[{\"paymentInstrumentId\":\"lchqggAAAAABAACA\",\"chargedAmount\":10.99}],\"productId\":\"CFQ7TTC0K5DJ\",\"productReturnCategorization\":\"App.Purchase\",\"productType\":\"PASS\",\"quantity\":1,\"retailPrice\":9.99,\"shipToAddressId\":\"\",\"skuId\":\"000C\",\"taxAmount\":1.00,\"taxType\":\"TaxesNotIncluded\",\"title\":\"Xbox Live Gold 1 Month\",\"totalAmount\":10.99,\"recurrenceId\":\"mdr:1055518870507325:1277730306f34c3998bbc89b759e95a5:2c1bcc81-9d16-4473-8549-13302c38f132\"}],\"orderPlacedDate\":\"2019-10-18T01:10:02.4130199+00:00\",\"orderState\":\"Purchased\",\"orderValidityEndTime\":\"2019-10-19T01:09:43.3804258+00:00\",\"orderValidityStartTime\":\"2019-10-18T01:09:43.3804258+00:00\",\"promoCodes\":[],\"purchaser\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"shortOrderId\":\"4347142026\",\"taxDetails\":[{\"jurisdiction\":\"WASHINGTON\",\"taxAmount\":0.65,\"taxType\":\"Retail Sales and Use Tax\"},{\"jurisdiction\":\"KING\",\"taxAmount\":0.0,\"taxType\":\"Local Sales and Use Tax\"},{\"jurisdiction\":\"REDMOND\",\"taxAmount\":0.21,\"taxType\":\"Local Sales and Use Tax\"},{\"jurisdiction\":\"REGIONAL TRANSIT AUTHORITY\",\"taxAmount\":0.14,\"taxType\":\"Local Sales and Use Tax\"}],\"testScenarios\":\"TestUser\",\"totalAmount\":10.99,\"totalAmountBeforeTax\":9.99,\"totalAmusementTax\":0.0,\"totalChargedToCsvTopOffPI\":0.0,\"totalDeliveryPriceAmount\":0.0,\"totalDeliveryPriceTaxAmount\":0.0,\"totalFeeAmount\":0.0,\"totalItemAmount\":9.99,\"totalSalesTax\":1.00,\"totalTaxAmount\":1.00,\"version\":\"7.0\"},{\"billingInformation\":{\"billingRecordId\":\"40ad3641-c4e3-4687-b1be-83e1797be95f\",\"billingRecordVersion\":0,\"paymentInstrumentId\":\"lchqggAAAAABAACA\",\"sessionId\":\"34ba717c-f4a1-4351-aae6-b308d4b91e2f\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"taxInfoReference\":\"00000000-0000-0000-0000-000000000000\",\"tokenizedPaymentInstrumentData\":\"\"},\"bundlePrices\":[],\"clientContext\":{\"client\":\"UniversalWebStore.Cart\",\"deviceId\":\"6966500065365589\",\"deviceType\":\"Unknown\"},\"createdTime\":\"2019-10-18T01:11:31.2658115+00:00\",\"currencyCode\":\"USD\",\"displayTotalFeeAmount\":0.0,\"friendlyName\":\"cart-US\",\"isInManualReview\":false,\"isPIRequired\":true,\"RequiresPIValidation\":\"NotRequired\",\"isUpdatePIAllowed\":false,\"language\":\"en-US\",\"manualReviewRiskDecision\":\"None\",\"market\":\"US\",\"omniChannelFulfillmentId\":\"\",\"orderAdditionalMetadata\":\"{}\",\"orderId\":\"365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\",\"orderLineItems\":[{\"availabilityId\":\"CFQ7TTBZX6SV\",\"beneficiary\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"billingState\":\"Charged\",\"currencyCode\":\"USD\",\"description\":\"Office 365 Home\",\"fulfillmentDate\":\"2019-10-18T01:12:27.1624091+00:00\",\"fulfillmentState\":\"Fulfilled\",\"isPIRequired\":true,\"isTaxIncluded\":false,\"lineItemId\":\"dc2ddb68-0774-4cf8-b81c-b8111253585b\",\"listPrice\":9.99,\"fulfillmentStates\":[{\"cancelable\":true,\"canceled\":false,\"fulfillmentQuantityId\":\"aab4a299-0ad6-4fad-b5fe-9443f108b585\",\"fulfillmentReturnType\":0,\"fulfillmentState\":\"Fulfilled\",\"refundJustifications\":[]}],\"billingStates\":[{\"startIndex\":0,\"endIndex\":0,\"billingState\":\"Charged\",\"totalChargedAmount\":10.99,\"totalRefundedAmount\":0.0,\"totalRefundedTaxAmount\":0.0,\"totalRefundedFeeAmount\":0.0,\"totalRefundedFeeTaxAmount\":0.0}],\"fulfillmentBillingStates\":[{\"billingState\":\"Charged\",\"count\":1,\"fulfillmentState\":\"Fulfilled\"}],\"parentalApprovalState\":\"None\",\"payments\":[{\"paymentInstrumentId\":\"lchqggAAAAABAACA\",\"chargedAmount\":10.99}],\"productId\":\"CFQ7TTC0K5DM\",\"productReturnCategorization\":\"App.Purchase\",\"productType\":\"PASS\",\"quantity\":1,\"retailPrice\":9.99,\"shipToAddressId\":\"\",\"skuId\":\"007P\",\"taxAmount\":1.00,\"taxType\":\"TaxesNotIncluded\",\"title\":\"Office 365 Home\",\"totalAmount\":10.99,\"recurrenceId\":\"mdr:1055518870507325:e4e59792df594f0c959cb7ac0ad9f0bd:365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\"}],\"orderPlacedDate\":\"2019-10-18T01:12:27.4436338+00:00\",\"orderState\":\"Purchased\",\"orderValidityEndTime\":\"2019-10-19T01:11:31.2658115+00:00\",\"orderValidityStartTime\":\"2019-10-18T01:11:31.2658115+00:00\",\"promoCodes\":[],\"purchaser\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"riskSessionId\":\"90d00e75-6bc6-4d6f-bea4-b9c99a4e1b13\",\"shortOrderId\":\"3629174985\",\"taxDetails\":[{\"jurisdiction\":\"WASHINGTON\",\"taxAmount\":0.65,\"taxType\":\"Retail Sales and Use Tax\"},{\"jurisdiction\":\"KING\",\"taxAmount\":0.0,\"taxType\":\"Local Sales and Use Tax\"},{\"jurisdiction\":\"REDMOND\",\"taxAmount\":0.21,\"taxType\":\"Local Sales and Use Tax\"},{\"jurisdiction\":\"REGIONAL TRANSIT AUTHORITY\",\"taxAmount\":0.14,\"taxType\":\"Local Sales and Use Tax\"}],\"testScenarios\":\"TestUser\",\"totalAmount\":10.99,\"totalAmountBeforeTax\":9.99,\"totalAmusementTax\":0.0,\"totalChargedToCsvTopOffPI\":0.0,\"totalDeliveryPriceAmount\":0.0,\"totalDeliveryPriceTaxAmount\":0.0,\"totalFeeAmount\":0.0,\"totalItemAmount\":9.99,\"totalSalesTax\":1.00,\"totalTaxAmount\":1.00,\"version\":\"7.0\"},{\"billingInformation\":{\"billingRecordId\":\"feb03acb-243d-42ac-832a-231466d34eac\",\"billingRecordVersion\":0,\"paymentInstrumentId\":\"lchqggAAAAAHAACA\",\"sessionId\":\"e9e0d911-603d-469d-a69f-32f0a2151699\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"taxInfoReference\":\"00000000-0000-0000-0000-000000000000\",\"tokenizedPaymentInstrumentData\":\"\"},\"bundlePrices\":[],\"clientContext\":{\"client\":\"Universal Store Native Client\",\"deviceFamily\":\"Windows.Desktop\",\"deviceId\":\"6825768918790850\",\"deviceType\":\"Unknown\"},\"createdTime\":\"2019-11-14T22:07:02.7388215+00:00\",\"currencyCode\":\"USD\",\"displayTotalFeeAmount\":0.0,\"isInManualReview\":false,\"isPIRequired\":true,\"RequiresPIValidation\":\"NotRequired\",\"isUpdatePIAllowed\":false,\"language\":\"en-US,zh-Hans-CN\",\"manualReviewRiskDecision\":\"None\",\"market\":\"US\",\"omniChannelFulfillmentId\":\"\",\"orderId\":\"f5598585-7340-4c5b-b41e-3df950c4925e\",\"orderLineItems\":[{\"availabilityId\":\"9SRH01VQWHM7\",\"beneficiary\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"billingState\":\"Charged\",\"campaignId\":\"\",\"currencyCode\":\"USD\",\"description\":\"Riptide GP™2 kicks everything into overdrive, with intense dynamic water racing, upgradeable hydro jets and riders, improved graphics, an all-new career mode, and a whole new stunt system with dozens of new tricks!  \\r\\n\\r\\nFeaturing rocket-powered hydro jets racing around futuristic tracks across a dynamic and interactive water surface, Riptide GP2 delivers a fast, fun, and visually stunning racing experience.\\r\\n\\r\\nFrom Vector Unit, developers of acclaimed racing games Riptide GP and Hydro Thunder Hurricane.\",\"devOfferId\":\"\",\"fulfillmentDate\":\"2019-11-14T22:07:12.0200785+00:00\",\"fulfillmentState\":\"Fulfilled\",\"isPIRequired\":true,\"isTaxIncluded\":false,\"lineItemId\":\"16bd31de-d49a-41c2-aa95-9de6d8117082\",\"listPrice\":2.99,\"optionalCampaignId\":\"ems.dco.storespotlight\",\"fulfillmentStates\":[{\"cancelable\":true,\"canceled\":false,\"fulfillmentQuantityId\":\"f939712d-a354-4101-ad7c-e606aaaab647\",\"fulfillmentReturnType\":0,\"fulfillmentState\":\"Fulfilled\",\"refundJustifications\":[]}],\"billingStates\":[{\"startIndex\":0,\"endIndex\":0,\"billingState\":\"Charged\",\"totalChargedAmount\":3.28,\"totalRefundedAmount\":0.0,\"totalRefundedTaxAmount\":0.0,\"totalRefundedFeeAmount\":0.0,\"totalRefundedFeeTaxAmount\":0.0}],\"fulfillmentBillingStates\":[{\"billingState\":\"Charged\",\"count\":1,\"fulfillmentState\":\"Fulfilled\"}],\"parentalApprovalState\":\"None\",\"payments\":[{\"paymentInstrumentId\":\"lchqggAAAAAHAACA\",\"chargedAmount\":3.28}],\"productId\":\"9WZDNCRFJ9Z1\",\"productReturnCategorization\":\"App.Purchase\",\"productType\":\"Game\",\"quantity\":1,\"retailPrice\":2.99,\"shipToAddressId\":\"\",\"skuId\":\"0010\",\"taxAmount\":0.29,\"taxType\":\"TaxesNotIncluded\",\"title\":\"Riptide GP2\",\"totalAmount\":3.28}],\"orderPlacedDate\":\"2019-11-14T22:07:12.0200785+00:00\",\"orderState\":\"Purchased\",\"orderValidityEndTime\":\"2019-11-15T22:07:02.7388215+00:00\",\"orderValidityStartTime\":\"2019-11-14T22:07:02.7388215+00:00\",\"promoCodes\":[],\"purchaser\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"shortOrderId\":\"4532524856\",\"taxDetails\":[{\"jurisdiction\":\"WASHINGTON\",\"taxAmount\":0.19,\"taxType\":\"Retail Sales and Use Tax\"},{\"jurisdiction\":\"KING\",\"taxAmount\":0.0,\"taxType\":\"Local Sales and Use Tax\"},{\"jurisdiction\":\"REDMOND\",\"taxAmount\":0.06,\"taxType\":\"Local Sales and Use Tax\"},{\"jurisdiction\":\"REGIONAL TRANSIT AUTHORITY\",\"taxAmount\":0.04,\"taxType\":\"Local Sales and Use Tax\"}],\"testScenarios\":\"TestUser\",\"totalAmount\":3.28,\"totalAmountBeforeTax\":2.99,\"totalAmusementTax\":0.0,\"totalChargedToCsvTopOffPI\":0.0,\"totalDeliveryPriceAmount\":0.0,\"totalDeliveryPriceTaxAmount\":0.0,\"totalFeeAmount\":0.0,\"totalItemAmount\":2.99,\"totalSalesTax\":0.29,\"totalTaxAmount\":0.29,\"version\":\"7.0\"}]}";
                    }
                    else
                    {
                        string nextLink = GetNextLink(request.RequestUri, "page2");
                        responseContent = "{\"items\":[{\"bundlePrices\":[],\"clientContext\":{\"client\":\"UniversalWebStore.Cart\",\"deviceId\":\"6966500065365589\",\"deviceType\":\"Unknown\"},\"createdTime\":\"2019-10-18T01:11:34.4875638+00:00\",\"currencyCode\":null,\"displayTotalFeeAmount\":null,\"friendlyName\":\"cart-save-for-later-US\",\"isInManualReview\":false,\"isPIRequired\":false,\"RequiresPIValidation\":\"NotRequired\",\"isUpdatePIAllowed\":false,\"language\":\"en-US\",\"manualReviewRiskDecision\":\"None\",\"market\":\"US\",\"omniChannelFulfillmentId\":\"\",\"orderAdditionalMetadata\":\"{}\",\"orderId\":\"007b3d5d-18a1-4ce8-a2f7-57a8d89c4336\",\"orderLineItems\":[],\"orderState\":\"Editing\",\"orderValidityEndTime\":\"2019-10-19T01:11:34.4875638+00:00\",\"orderValidityStartTime\":\"2019-10-18T01:11:34.4875638+00:00\",\"promoCodes\":[],\"purchaser\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"riskSessionId\":\"90d00e75-6bc6-4d6f-bea4-b9c99a4e1b13\",\"shortOrderId\":\"3611975540\",\"taxDetails\":[],\"testScenarios\":\"TestUser\",\"totalAmount\":0.0,\"totalAmountBeforeTax\":0.0,\"totalAmusementTax\":0.0,\"totalChargedToCsvTopOffPI\":0.0,\"totalItemAmount\":0.0,\"totalSalesTax\":0.0,\"totalTaxAmount\":0.0,\"version\":\"7.0\"},{\"billingInformation\":{\"billingRecordId\":\"17c63d81-472d-40f4-b8bb-f614ca890cbd\",\"billingRecordVersion\":0,\"paymentInstrumentId\":\"lchqggAAAAABAACA\",\"sessionId\":\"77e926f3-1757-4015-95fa-707bfb87fe35\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"taxInfoReference\":\"00000000-0000-0000-0000-000000000000\",\"tokenizedPaymentInstrumentData\":\"\"},\"bundlePrices\":[],\"clientContext\":{\"client\":\"UniversalWebStore\",\"deviceFamily\":\"Web\",\"deviceId\":\"6966500065365589\",\"deviceType\":\"Unknown\"},\"createdTime\":\"2019-10-18T01:09:43.3804258+00:00\",\"currencyCode\":\"USD\",\"displayTotalFeeAmount\":0.0,\"isInManualReview\":false,\"isPIRequired\":true,\"RequiresPIValidation\":\"NotRequired\",\"isUpdatePIAllowed\":false,\"language\":\"en-us\",\"manualReviewRiskDecision\":\"None\",\"market\":\"US\",\"omniChannelFulfillmentId\":\"\",\"orderId\":\"2c1bcc81-9d16-4473-8549-13302c38f132\",\"orderLineItems\":[{\"availabilityId\":\"CFQ7TTC0J7FM\",\"beneficiary\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"billingState\":\"Charged\",\"currencyCode\":\"USD\",\"description\":\"Xbox Live Gold 1 Month\",\"fulfillmentDate\":\"2019-10-18T01:10:02.1161486+00:00\",\"fulfillmentState\":\"Fulfilled\",\"isPIRequired\":true,\"isTaxIncluded\":false,\"lineItemId\":\"83a30054-9860-48a4-8952-da76d88d1fda\",\"listPrice\":9.99,\"fulfillmentStates\":[{\"cancelable\":true,\"canceled\":false,\"fulfillmentQuantityId\":\"27ae8af2-caae-4551-85b3-fe8564d8a7c1\",\"fulfillmentReturnType\":0,\"fulfillmentState\":\"Fulfilled\",\"refundJustifications\":[]}],\"billingStates\":[{\"startIndex\":0,\"endIndex\":0,\"billingState\":\"Charged\",\"totalChargedAmount\":10.99,\"totalRefundedAmount\":0.0,\"totalRefundedTaxAmount\":0.0,\"totalRefundedFeeAmount\":0.0,\"totalRefundedFeeTaxAmount\":0.0}],\"fulfillmentBillingStates\":[{\"billingState\":\"Charged\",\"count\":1,\"fulfillmentState\":\"Fulfilled\"}],\"parentalApprovalState\":\"None\",\"payments\":[{\"paymentInstrumentId\":\"lchqggAAAAABAACA\",\"chargedAmount\":10.99}],\"productId\":\"CFQ7TTC0K5DJ\",\"productReturnCategorization\":\"App.Purchase\",\"productType\":\"PASS\",\"quantity\":1,\"retailPrice\":9.99,\"shipToAddressId\":\"\",\"skuId\":\"000C\",\"taxAmount\":1.00,\"taxType\":\"TaxesNotIncluded\",\"title\":\"Xbox Live Gold 1 Month\",\"totalAmount\":10.99,\"recurrenceId\":\"mdr:1055518870507325:1277730306f34c3998bbc89b759e95a5:2c1bcc81-9d16-4473-8549-13302c38f132\"}],\"orderPlacedDate\":\"2019-10-18T01:10:02.4130199+00:00\",\"orderState\":\"Purchased\",\"orderValidityEndTime\":\"2019-10-19T01:09:43.3804258+00:00\",\"orderValidityStartTime\":\"2019-10-18T01:09:43.3804258+00:00\",\"promoCodes\":[],\"purchaser\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"shortOrderId\":\"4347142026\",\"taxDetails\":[{\"jurisdiction\":\"WASHINGTON\",\"taxAmount\":0.65,\"taxType\":\"Retail Sales and Use Tax\"},{\"jurisdiction\":\"KING\",\"taxAmount\":0.0,\"taxType\":\"Local Sales and Use Tax\"},{\"jurisdiction\":\"REDMOND\",\"taxAmount\":0.21,\"taxType\":\"Local Sales and Use Tax\"},{\"jurisdiction\":\"REGIONAL TRANSIT AUTHORITY\",\"taxAmount\":0.14,\"taxType\":\"Local Sales and Use Tax\"}],\"testScenarios\":\"TestUser\",\"totalAmount\":10.99,\"totalAmountBeforeTax\":9.99,\"totalAmusementTax\":0.0,\"totalChargedToCsvTopOffPI\":0.0,\"totalDeliveryPriceAmount\":0.0,\"totalDeliveryPriceTaxAmount\":0.0,\"totalFeeAmount\":0.0,\"totalItemAmount\":9.99,\"totalSalesTax\":1.00,\"totalTaxAmount\":1.00,\"version\":\"7.0\"},{\"billingInformation\":{\"billingRecordId\":\"40ad3641-c4e3-4687-b1be-83e1797be95f\",\"billingRecordVersion\":0,\"paymentInstrumentId\":\"lchqggAAAAABAACA\",\"sessionId\":\"34ba717c-f4a1-4351-aae6-b308d4b91e2f\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"taxInfoReference\":\"00000000-0000-0000-0000-000000000000\",\"tokenizedPaymentInstrumentData\":\"\"},\"bundlePrices\":[],\"clientContext\":{\"client\":\"UniversalWebStore.Cart\",\"deviceId\":\"6966500065365589\",\"deviceType\":\"Unknown\"},\"createdTime\":\"2019-10-18T01:11:31.2658115+00:00\",\"currencyCode\":\"USD\",\"displayTotalFeeAmount\":0.0,\"friendlyName\":\"cart-US\",\"isInManualReview\":false,\"isPIRequired\":true,\"RequiresPIValidation\":\"NotRequired\",\"isUpdatePIAllowed\":false,\"language\":\"en-US\",\"manualReviewRiskDecision\":\"None\",\"market\":\"US\",\"omniChannelFulfillmentId\":\"\",\"orderAdditionalMetadata\":\"{}\",\"orderId\":\"365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\",\"orderLineItems\":[{\"availabilityId\":\"CFQ7TTBZX6SV\",\"beneficiary\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"billingState\":\"Charged\",\"currencyCode\":\"USD\",\"description\":\"Office 365 Home\",\"fulfillmentDate\":\"2019-10-18T01:12:27.1624091+00:00\",\"fulfillmentState\":\"Fulfilled\",\"isPIRequired\":true,\"isTaxIncluded\":false,\"lineItemId\":\"dc2ddb68-0774-4cf8-b81c-b8111253585b\",\"listPrice\":9.99,\"fulfillmentStates\":[{\"cancelable\":true,\"canceled\":false,\"fulfillmentQuantityId\":\"aab4a299-0ad6-4fad-b5fe-9443f108b585\",\"fulfillmentReturnType\":0,\"fulfillmentState\":\"Fulfilled\",\"refundJustifications\":[]}],\"billingStates\":[{\"startIndex\":0,\"endIndex\":0,\"billingState\":\"Charged\",\"totalChargedAmount\":10.99,\"totalRefundedAmount\":0.0,\"totalRefundedTaxAmount\":0.0,\"totalRefundedFeeAmount\":0.0,\"totalRefundedFeeTaxAmount\":0.0}],\"fulfillmentBillingStates\":[{\"billingState\":\"Charged\",\"count\":1,\"fulfillmentState\":\"Fulfilled\"}],\"parentalApprovalState\":\"None\",\"payments\":[{\"paymentInstrumentId\":\"lchqggAAAAABAACA\",\"chargedAmount\":10.99}],\"productId\":\"CFQ7TTC0K5DM\",\"productReturnCategorization\":\"App.Purchase\",\"productType\":\"PASS\",\"quantity\":1,\"retailPrice\":9.99,\"shipToAddressId\":\"\",\"skuId\":\"007P\",\"taxAmount\":1.00,\"taxType\":\"TaxesNotIncluded\",\"title\":\"Office 365 Home\",\"totalAmount\":10.99,\"recurrenceId\":\"mdr:1055518870507325:e4e59792df594f0c959cb7ac0ad9f0bd:365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\"}],\"orderPlacedDate\":\"2019-10-18T01:12:27.4436338+00:00\",\"orderState\":\"Purchased\",\"orderValidityEndTime\":\"2019-10-19T01:11:31.2658115+00:00\",\"orderValidityStartTime\":\"2019-10-18T01:11:31.2658115+00:00\",\"promoCodes\":[],\"purchaser\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"riskSessionId\":\"90d00e75-6bc6-4d6f-bea4-b9c99a4e1b13\",\"shortOrderId\":\"3629174985\",\"taxDetails\":[{\"jurisdiction\":\"WASHINGTON\",\"taxAmount\":0.65,\"taxType\":\"Retail Sales and Use Tax\"},{\"jurisdiction\":\"KING\",\"taxAmount\":0.0,\"taxType\":\"Local Sales and Use Tax\"},{\"jurisdiction\":\"REDMOND\",\"taxAmount\":0.21,\"taxType\":\"Local Sales and Use Tax\"},{\"jurisdiction\":\"REGIONAL TRANSIT AUTHORITY\",\"taxAmount\":0.14,\"taxType\":\"Local Sales and Use Tax\"}],\"testScenarios\":\"TestUser\",\"totalAmount\":10.99,\"totalAmountBeforeTax\":9.99,\"totalAmusementTax\":0.0,\"totalChargedToCsvTopOffPI\":0.0,\"totalDeliveryPriceAmount\":0.0,\"totalDeliveryPriceTaxAmount\":0.0,\"totalFeeAmount\":0.0,\"totalItemAmount\":9.99,\"totalSalesTax\":1.00,\"totalTaxAmount\":1.00,\"version\":\"7.0\"},{\"billingInformation\":{\"billingRecordId\":\"feb03acb-243d-42ac-832a-231466d34eac\",\"billingRecordVersion\":0,\"paymentInstrumentId\":\"lchqggAAAAAHAACA\",\"sessionId\":\"e9e0d911-603d-469d-a69f-32f0a2151699\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"taxInfoReference\":\"00000000-0000-0000-0000-000000000000\",\"tokenizedPaymentInstrumentData\":\"\"},\"bundlePrices\":[],\"clientContext\":{\"client\":\"Universal Store Native Client\",\"deviceFamily\":\"Windows.Desktop\",\"deviceId\":\"6825768918790850\",\"deviceType\":\"Unknown\"},\"createdTime\":\"2019-11-14T22:07:02.7388215+00:00\",\"currencyCode\":\"USD\",\"displayTotalFeeAmount\":0.0,\"isInManualReview\":false,\"isPIRequired\":true,\"RequiresPIValidation\":\"NotRequired\",\"isUpdatePIAllowed\":false,\"language\":\"en-US,zh-Hans-CN\",\"manualReviewRiskDecision\":\"None\",\"market\":\"US\",\"omniChannelFulfillmentId\":\"\",\"orderId\":\"f5598585-7340-4c5b-b41e-3df950c4925e\",\"orderLineItems\":[{\"availabilityId\":\"9SRH01VQWHM7\",\"beneficiary\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"billingState\":\"Charged\",\"campaignId\":\"\",\"currencyCode\":\"USD\",\"description\":\"Riptide GP™2 kicks everything into overdrive, with intense dynamic water racing, upgradeable hydro jets and riders, improved graphics, an all-new career mode, and a whole new stunt system with dozens of new tricks!  \\r\\n\\r\\nFeaturing rocket-powered hydro jets racing around futuristic tracks across a dynamic and interactive water surface, Riptide GP2 delivers a fast, fun, and visually stunning racing experience.\\r\\n\\r\\nFrom Vector Unit, developers of acclaimed racing games Riptide GP and Hydro Thunder Hurricane.\",\"devOfferId\":\"\",\"fulfillmentDate\":\"2019-11-14T22:07:12.0200785+00:00\",\"fulfillmentState\":\"Fulfilled\",\"isPIRequired\":true,\"isTaxIncluded\":false,\"lineItemId\":\"16bd31de-d49a-41c2-aa95-9de6d8117082\",\"listPrice\":2.99,\"optionalCampaignId\":\"ems.dco.storespotlight\",\"fulfillmentStates\":[{\"cancelable\":true,\"canceled\":false,\"fulfillmentQuantityId\":\"f939712d-a354-4101-ad7c-e606aaaab647\",\"fulfillmentReturnType\":0,\"fulfillmentState\":\"Fulfilled\",\"refundJustifications\":[]}],\"billingStates\":[{\"startIndex\":0,\"endIndex\":0,\"billingState\":\"Charged\",\"totalChargedAmount\":3.28,\"totalRefundedAmount\":0.0,\"totalRefundedTaxAmount\":0.0,\"totalRefundedFeeAmount\":0.0,\"totalRefundedFeeTaxAmount\":0.0}],\"fulfillmentBillingStates\":[{\"billingState\":\"Charged\",\"count\":1,\"fulfillmentState\":\"Fulfilled\"}],\"parentalApprovalState\":\"None\",\"payments\":[{\"paymentInstrumentId\":\"lchqggAAAAAHAACA\",\"chargedAmount\":3.28}],\"productId\":\"9WZDNCRFJ9Z1\",\"productReturnCategorization\":\"App.Purchase\",\"productType\":\"Game\",\"quantity\":1,\"retailPrice\":2.99,\"shipToAddressId\":\"\",\"skuId\":\"0010\",\"taxAmount\":0.29,\"taxType\":\"TaxesNotIncluded\",\"title\":\"Riptide GP2\",\"totalAmount\":3.28}],\"orderPlacedDate\":\"2019-11-14T22:07:12.0200785+00:00\",\"orderState\":\"Purchased\",\"orderValidityEndTime\":\"2019-11-15T22:07:02.7388215+00:00\",\"orderValidityStartTime\":\"2019-11-14T22:07:02.7388215+00:00\",\"promoCodes\":[],\"purchaser\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"shortOrderId\":\"4532524856\",\"taxDetails\":[{\"jurisdiction\":\"WASHINGTON\",\"taxAmount\":0.19,\"taxType\":\"Retail Sales and Use Tax\"},{\"jurisdiction\":\"KING\",\"taxAmount\":0.0,\"taxType\":\"Local Sales and Use Tax\"},{\"jurisdiction\":\"REDMOND\",\"taxAmount\":0.06,\"taxType\":\"Local Sales and Use Tax\"},{\"jurisdiction\":\"REGIONAL TRANSIT AUTHORITY\",\"taxAmount\":0.04,\"taxType\":\"Local Sales and Use Tax\"}],\"testScenarios\":\"TestUser\",\"totalAmount\":3.28,\"totalAmountBeforeTax\":2.99,\"totalAmusementTax\":0.0,\"totalChargedToCsvTopOffPI\":0.0,\"totalDeliveryPriceAmount\":0.0,\"totalDeliveryPriceTaxAmount\":0.0,\"totalFeeAmount\":0.0,\"totalItemAmount\":2.99,\"totalSalesTax\":0.29,\"totalTaxAmount\":0.29,\"version\":\"7.0\"}], \"@nextLink\": \"@nextLinkPlaceHolder\" }";
                        responseContent = responseContent.Replace("@nextLinkPlaceHolder", nextLink);
                    }
                }
                else if (request.RequestUri.ToString().Contains("recurrences"))
                {
                    responseContent = "{\"items\":[{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"count\":1,\"documentVersion\":0,\"entitlementId\":\"c2a64109c7444dac9ccaadb759936684\",\"entitlementIds\":[\"c2a64109c7444dac9ccaadb759936684\"],\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"id\":\"mdr:1055518870507325:1277730306f34c3998bbc89b759e95a5:2c1bcc81-9d16-4473-8549-13302c38f132\",\"isMasteredInModern\":true,\"isTrial\":false,\"isWithinResellerRestrictionPeriod\":false,\"language\":\"en-us\",\"lastModified\":\"2019-11-14T22:57:44.1141996+00:00\",\"market\":\"US\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"modernRevenueRecognitionScheduleId\":\"08ce08c6-64ac-4938-bf8e-d1d382f0a17a\",\"paymentInstrumentId\":\"lchqggAAAAAIAACA\",\"paymentInstrumentSessionId\":\"77e926f3-1757-4015-95fa-707bfb87fe35\",\"productId\":\"CFQ7TTC0K5DJ\",\"purchaser\":\"msa:1055518870507325\",\"recurrenceGroup\":\"Classic Gold\",\"recurrencePolicyId\":\"Monthly\",\"recurrenceState\":\"Active\",\"renewalTag\":\"CFQ7TTC0K5DJ_142ff8f7-c4bb-4d74-adad-b2a2f0079cd9\",\"revenueRecognitionEndDate\":\"2019-12-02T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"000C\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"startTime\":\"2019-10-18T00:00:00+00:00\",\"changeRecords\":[{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"clientContext\":{\"client\":\"UniversalWebStore\"},\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"c2a64109c7444dac9ccaadb759936684\",\"entitlementIds\":[\"c2a64109c7444dac9ccaadb759936684\"],\"eventSequence\":1,\"eventTime\":\"2019-10-18T01:10:02.1161486+00:00\",\"eventType\":\"Created\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-us\",\"lotId\":100,\"market\":\"US\",\"modernRevenueRecognitionScheduleId\":\"08ce08c6-64ac-4938-bf8e-d1d382f0a17a\",\"orderId\":\"2c1bcc81-9d16-4473-8549-13302c38f132\",\"orderLineItemId\":\"83a30054-9860-48a4-8952-da76d88d1fda\",\"paymentInstrumentId\":\"lchqggAAAAABAACA\",\"paymentInstrumentSessionId\":\"77e926f3-1757-4015-95fa-707bfb87fe35\",\"productId\":\"CFQ7TTC0K5DJ\",\"recurrenceGroup\":\"Classic Gold\",\"recurrencePolicyId\":\"Monthly\",\"renewalTag\":\"CFQ7TTC0K5DJ_142ff8f7-c4bb-4d74-adad-b2a2f0079cd9\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"Direct\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"XMR-00001\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2019-12-02T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"000C\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"c2a64109-c744-4dac-9cca-adb759936684\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"c2a64109c7444dac9ccaadb759936684\",\"entitlementIds\":[\"c2a64109c7444dac9ccaadb759936684\"],\"eventSequence\":2,\"eventTime\":\"2019-10-18T22:41:36.2429604+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-us\",\"market\":\"US\",\"orderId\":\"2c1bcc81-9d16-4473-8549-13302c38f132\",\"orderLineItemId\":\"83a30054-9860-48a4-8952-da76d88d1fda\",\"paymentInstrumentId\":\"lchqggAAAAACAACA\",\"paymentInstrumentSessionId\":\"77e926f3-1757-4015-95fa-707bfb87fe35\",\"productId\":\"CFQ7TTC0K5DJ\",\"recurrenceGroup\":\"Classic Gold\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"Direct\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"XMR-00001\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2019-12-02T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"000C\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"433c6c57-332e-486a-b8a7-09998eb301b0\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"c2a64109c7444dac9ccaadb759936684\",\"entitlementIds\":[\"c2a64109c7444dac9ccaadb759936684\"],\"eventSequence\":3,\"eventTime\":\"2019-10-18T23:31:44.9973579+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-us\",\"market\":\"US\",\"orderId\":\"2c1bcc81-9d16-4473-8549-13302c38f132\",\"orderLineItemId\":\"83a30054-9860-48a4-8952-da76d88d1fda\",\"paymentInstrumentId\":\"lchqggAAAAAEAACA\",\"paymentInstrumentSessionId\":\"77e926f3-1757-4015-95fa-707bfb87fe35\",\"productId\":\"CFQ7TTC0K5DJ\",\"recurrenceGroup\":\"Classic Gold\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"Direct\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"XMR-00001\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2019-12-02T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"000C\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"bb56de10-5bf9-43e0-b51a-97ed726f4117\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"c2a64109c7444dac9ccaadb759936684\",\"entitlementIds\":[\"c2a64109c7444dac9ccaadb759936684\"],\"eventSequence\":4,\"eventTime\":\"2019-10-24T18:13:15.7172801+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-us\",\"market\":\"US\",\"orderId\":\"2c1bcc81-9d16-4473-8549-13302c38f132\",\"orderLineItemId\":\"83a30054-9860-48a4-8952-da76d88d1fda\",\"paymentInstrumentId\":\"lchqggAAAAAFAACA\",\"paymentInstrumentSessionId\":\"77e926f3-1757-4015-95fa-707bfb87fe35\",\"productId\":\"CFQ7TTC0K5DJ\",\"recurrenceGroup\":\"Classic Gold\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"Direct\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"XMR-00001\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2019-12-02T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"000C\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"9f38c124-d3a8-4dd7-9d44-ae7328b8e0c4\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"c2a64109c7444dac9ccaadb759936684\",\"entitlementIds\":[\"c2a64109c7444dac9ccaadb759936684\"],\"eventSequence\":5,\"eventTime\":\"2019-10-24T18:18:07.2526282+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-us\",\"market\":\"US\",\"orderId\":\"2c1bcc81-9d16-4473-8549-13302c38f132\",\"orderLineItemId\":\"83a30054-9860-48a4-8952-da76d88d1fda\",\"paymentInstrumentId\":\"lchqggAAAAAGAACA\",\"paymentInstrumentSessionId\":\"77e926f3-1757-4015-95fa-707bfb87fe35\",\"productId\":\"CFQ7TTC0K5DJ\",\"recurrenceGroup\":\"Classic Gold\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"Direct\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"XMR-00001\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2019-12-02T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"000C\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"96224ee2-7023-448a-8bc5-e807571a8b35\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"c2a64109c7444dac9ccaadb759936684\",\"entitlementIds\":[\"c2a64109c7444dac9ccaadb759936684\"],\"eventSequence\":6,\"eventTime\":\"2019-11-14T21:58:03.1793821+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-us\",\"market\":\"US\",\"orderId\":\"2c1bcc81-9d16-4473-8549-13302c38f132\",\"orderLineItemId\":\"83a30054-9860-48a4-8952-da76d88d1fda\",\"paymentInstrumentId\":\"lchqggAAAAAHAACA\",\"paymentInstrumentSessionId\":\"77e926f3-1757-4015-95fa-707bfb87fe35\",\"productId\":\"CFQ7TTC0K5DJ\",\"recurrenceGroup\":\"Classic Gold\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"Direct\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"XMR-00001\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2019-12-02T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"000C\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"756fa261-b8b3-4806-b4e2-c37baeab051a\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"c2a64109c7444dac9ccaadb759936684\",\"entitlementIds\":[\"c2a64109c7444dac9ccaadb759936684\"],\"eventSequence\":7,\"eventTime\":\"2019-11-14T22:57:43.3328938+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-us\",\"market\":\"US\",\"orderId\":\"2c1bcc81-9d16-4473-8549-13302c38f132\",\"orderLineItemId\":\"83a30054-9860-48a4-8952-da76d88d1fda\",\"paymentInstrumentId\":\"lchqggAAAAAIAACA\",\"paymentInstrumentSessionId\":\"77e926f3-1757-4015-95fa-707bfb87fe35\",\"productId\":\"CFQ7TTC0K5DJ\",\"recurrenceGroup\":\"Classic Gold\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"Direct\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"XMR-00001\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2019-12-02T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"000C\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"24289b75-4fb4-4bb1-a2b7-8f453676d371\"}]},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"count\":1,\"documentVersion\":0,\"entitlementId\":\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\",\"entitlementIds\":[\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\"],\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"id\":\"mdr:1055518870507325:e4e59792df594f0c959cb7ac0ad9f0bd:365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\",\"isMasteredInModern\":true,\"isTrial\":false,\"isWithinResellerRestrictionPeriod\":false,\"language\":\"en-US\",\"lastModified\":\"2019-11-14T22:57:45.6454205+00:00\",\"market\":\"US\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"modernRevenueRecognitionScheduleId\":\"26a02d59-cfe4-492f-b59e-489f7ecd0f98\",\"paymentInstrumentId\":\"lchqggAAAAAIAACA\",\"paymentInstrumentSessionId\":\"34ba717c-f4a1-4351-aae6-b308d4b91e2f\",\"productId\":\"CFQ7TTC0K5DM\",\"purchaser\":\"msa:1055518870507325\",\"recurrenceGroup\":\"Office 365 (Worldwide)\",\"recurrencePolicyId\":\"Monthly\",\"recurrenceState\":\"Active\",\"revenueRecognitionEndDate\":\"2020-01-11T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"007P\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"startTime\":\"2019-10-18T00:00:00+00:00\",\"changeRecords\":[{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"clientContext\":{\"client\":\"UniversalWebStore.Cart\"},\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\",\"entitlementIds\":[\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\"],\"eventSequence\":1,\"eventTime\":\"2019-10-18T01:12:27.1624091+00:00\",\"eventType\":\"Created\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-US\",\"lotId\":100,\"market\":\"US\",\"modernRevenueRecognitionScheduleId\":\"26a02d59-cfe4-492f-b59e-489f7ecd0f98\",\"orderId\":\"365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\",\"orderLineItemId\":\"dc2ddb68-0774-4cf8-b81c-b8111253585b\",\"paymentInstrumentId\":\"lchqggAAAAABAACA\",\"paymentInstrumentSessionId\":\"34ba717c-f4a1-4351-aae6-b308d4b91e2f\",\"productId\":\"CFQ7TTC0K5DM\",\"recurrenceGroup\":\"Office 365 (Worldwide)\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"P2W-00003\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2020-01-11T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"007P\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"e6cdbe96-b6d6-4cfd-baaf-9778a4a62d6b\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\",\"entitlementIds\":[\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\"],\"eventSequence\":2,\"eventTime\":\"2019-10-18T22:41:37.5398358+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-US\",\"market\":\"US\",\"orderId\":\"365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\",\"orderLineItemId\":\"dc2ddb68-0774-4cf8-b81c-b8111253585b\",\"paymentInstrumentId\":\"lchqggAAAAACAACA\",\"paymentInstrumentSessionId\":\"34ba717c-f4a1-4351-aae6-b308d4b91e2f\",\"productId\":\"CFQ7TTC0K5DM\",\"recurrenceGroup\":\"Office 365 (Worldwide)\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"P2W-00003\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2020-01-11T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"007P\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"fc33748a-5aa4-4632-ab40-a6d9bc332c24\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\",\"entitlementIds\":[\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\"],\"eventSequence\":3,\"eventTime\":\"2019-10-18T23:31:46.5136168+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-US\",\"market\":\"US\",\"orderId\":\"365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\",\"orderLineItemId\":\"dc2ddb68-0774-4cf8-b81c-b8111253585b\",\"paymentInstrumentId\":\"lchqggAAAAAEAACA\",\"paymentInstrumentSessionId\":\"34ba717c-f4a1-4351-aae6-b308d4b91e2f\",\"productId\":\"CFQ7TTC0K5DM\",\"recurrenceGroup\":\"Office 365 (Worldwide)\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"P2W-00003\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2020-01-11T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"007P\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"abc8c5a4-2e30-4216-b0cc-040d19f5957c\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\",\"entitlementIds\":[\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\"],\"eventSequence\":4,\"eventTime\":\"2019-10-24T18:13:16.9360644+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-US\",\"market\":\"US\",\"orderId\":\"365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\",\"orderLineItemId\":\"dc2ddb68-0774-4cf8-b81c-b8111253585b\",\"paymentInstrumentId\":\"lchqggAAAAAFAACA\",\"paymentInstrumentSessionId\":\"34ba717c-f4a1-4351-aae6-b308d4b91e2f\",\"productId\":\"CFQ7TTC0K5DM\",\"recurrenceGroup\":\"Office 365 (Worldwide)\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"P2W-00003\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2020-01-11T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"007P\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"40234d79-7d05-4b54-b6c2-5f7041f18ffe\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\",\"entitlementIds\":[\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\"],\"eventSequence\":5,\"eventTime\":\"2019-10-24T18:18:08.6432625+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-US\",\"market\":\"US\",\"orderId\":\"365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\",\"orderLineItemId\":\"dc2ddb68-0774-4cf8-b81c-b8111253585b\",\"paymentInstrumentId\":\"lchqggAAAAAGAACA\",\"paymentInstrumentSessionId\":\"34ba717c-f4a1-4351-aae6-b308d4b91e2f\",\"productId\":\"CFQ7TTC0K5DM\",\"recurrenceGroup\":\"Office 365 (Worldwide)\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"P2W-00003\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2020-01-11T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"007P\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"1d6a2d00-3e36-4976-aeee-5dc8f4264cc5\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\",\"entitlementIds\":[\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\"],\"eventSequence\":6,\"eventTime\":\"2019-11-14T21:58:04.6793861+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-US\",\"market\":\"US\",\"orderId\":\"365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\",\"orderLineItemId\":\"dc2ddb68-0774-4cf8-b81c-b8111253585b\",\"paymentInstrumentId\":\"lchqggAAAAAHAACA\",\"paymentInstrumentSessionId\":\"34ba717c-f4a1-4351-aae6-b308d4b91e2f\",\"productId\":\"CFQ7TTC0K5DM\",\"recurrenceGroup\":\"Office 365 (Worldwide)\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"P2W-00003\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2020-01-11T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"007P\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"b484827f-4350-49e9-8531-4d6ca9901f7f\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\",\"entitlementIds\":[\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\"],\"eventSequence\":7,\"eventTime\":\"2019-11-14T22:57:44.7547727+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-US\",\"market\":\"US\",\"orderId\":\"365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\",\"orderLineItemId\":\"dc2ddb68-0774-4cf8-b81c-b8111253585b\",\"paymentInstrumentId\":\"lchqggAAAAAIAACA\",\"paymentInstrumentSessionId\":\"34ba717c-f4a1-4351-aae6-b308d4b91e2f\",\"productId\":\"CFQ7TTC0K5DM\",\"recurrenceGroup\":\"Office 365 (Worldwide)\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"P2W-00003\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2020-01-11T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"007P\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"015b19e5-f7e3-4ee0-ab34-29a1bb89e17d\"}]}]}";
                }
                else if (request.RequestUri.ToString().Contains("check"))
                {
                    var filteredCheckPiResult = GetCheckPIResult(trimmedSegments);
                    responseContent = JsonConvert.SerializeObject(filteredCheckPiResult);
                }
            }
            else if (request.RequestUri.ToString().Contains("check"))
            {
                var filteredCheckPiResult = GetCheckPIResult(trimmedSegments);
                responseContent = JsonConvert.SerializeObject(filteredCheckPiResult);
            }
            else if (request.RequestUri.ToString().Contains("recurrences"))
            {
                if (trimmedSegments.Length == 6)
                {
                    // GetSubscription
                    var filteredSubscription = Subscriptions.FirstOrDefault(x => trimmedSegments[5] == x.Id);
                    responseContent = JsonConvert.SerializeObject(filteredSubscription);
                }
                else
                {
                    // List Subscriptions
                    responseContent = "{\"items\":[{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"count\":1,\"documentVersion\":0,\"entitlementId\":\"c2a64109c7444dac9ccaadb759936684\",\"entitlementIds\":[\"c2a64109c7444dac9ccaadb759936684\"],\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"id\":\"mdr:1055518870507325:1277730306f34c3998bbc89b759e95a5:2c1bcc81-9d16-4473-8549-13302c38f132\",\"isMasteredInModern\":true,\"isTrial\":false,\"isWithinResellerRestrictionPeriod\":false,\"language\":\"en-us\",\"lastModified\":\"2019-11-14T22:57:44.1141996+00:00\",\"market\":\"US\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"modernRevenueRecognitionScheduleId\":\"08ce08c6-64ac-4938-bf8e-d1d382f0a17a\",\"paymentInstrumentId\":\"lchqggAAAAAIAACA\",\"paymentInstrumentSessionId\":\"77e926f3-1757-4015-95fa-707bfb87fe35\",\"productId\":\"CFQ7TTC0K5DJ\",\"purchaser\":\"msa:1055518870507325\",\"recurrenceGroup\":\"Classic Gold\",\"recurrencePolicyId\":\"Monthly\",\"recurrenceState\":\"Active\",\"renewalTag\":\"CFQ7TTC0K5DJ_142ff8f7-c4bb-4d74-adad-b2a2f0079cd9\",\"revenueRecognitionEndDate\":\"2019-12-02T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"000C\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"startTime\":\"2019-10-18T00:00:00+00:00\",\"changeRecords\":[{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"clientContext\":{\"client\":\"UniversalWebStore\"},\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"c2a64109c7444dac9ccaadb759936684\",\"entitlementIds\":[\"c2a64109c7444dac9ccaadb759936684\"],\"eventSequence\":1,\"eventTime\":\"2019-10-18T01:10:02.1161486+00:00\",\"eventType\":\"Created\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-us\",\"lotId\":100,\"market\":\"US\",\"modernRevenueRecognitionScheduleId\":\"08ce08c6-64ac-4938-bf8e-d1d382f0a17a\",\"orderId\":\"2c1bcc81-9d16-4473-8549-13302c38f132\",\"orderLineItemId\":\"83a30054-9860-48a4-8952-da76d88d1fda\",\"paymentInstrumentId\":\"lchqggAAAAABAACA\",\"paymentInstrumentSessionId\":\"77e926f3-1757-4015-95fa-707bfb87fe35\",\"productId\":\"CFQ7TTC0K5DJ\",\"recurrenceGroup\":\"Classic Gold\",\"recurrencePolicyId\":\"Monthly\",\"renewalTag\":\"CFQ7TTC0K5DJ_142ff8f7-c4bb-4d74-adad-b2a2f0079cd9\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"Direct\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"XMR-00001\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2019-12-02T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"000C\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"c2a64109-c744-4dac-9cca-adb759936684\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"c2a64109c7444dac9ccaadb759936684\",\"entitlementIds\":[\"c2a64109c7444dac9ccaadb759936684\"],\"eventSequence\":2,\"eventTime\":\"2019-10-18T22:41:36.2429604+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-us\",\"market\":\"US\",\"orderId\":\"2c1bcc81-9d16-4473-8549-13302c38f132\",\"orderLineItemId\":\"83a30054-9860-48a4-8952-da76d88d1fda\",\"paymentInstrumentId\":\"lchqggAAAAACAACA\",\"paymentInstrumentSessionId\":\"77e926f3-1757-4015-95fa-707bfb87fe35\",\"productId\":\"CFQ7TTC0K5DJ\",\"recurrenceGroup\":\"Classic Gold\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"Direct\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"XMR-00001\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2019-12-02T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"000C\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"433c6c57-332e-486a-b8a7-09998eb301b0\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"c2a64109c7444dac9ccaadb759936684\",\"entitlementIds\":[\"c2a64109c7444dac9ccaadb759936684\"],\"eventSequence\":3,\"eventTime\":\"2019-10-18T23:31:44.9973579+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-us\",\"market\":\"US\",\"orderId\":\"2c1bcc81-9d16-4473-8549-13302c38f132\",\"orderLineItemId\":\"83a30054-9860-48a4-8952-da76d88d1fda\",\"paymentInstrumentId\":\"lchqggAAAAAEAACA\",\"paymentInstrumentSessionId\":\"77e926f3-1757-4015-95fa-707bfb87fe35\",\"productId\":\"CFQ7TTC0K5DJ\",\"recurrenceGroup\":\"Classic Gold\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"Direct\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"XMR-00001\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2019-12-02T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"000C\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"bb56de10-5bf9-43e0-b51a-97ed726f4117\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"c2a64109c7444dac9ccaadb759936684\",\"entitlementIds\":[\"c2a64109c7444dac9ccaadb759936684\"],\"eventSequence\":4,\"eventTime\":\"2019-10-24T18:13:15.7172801+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-us\",\"market\":\"US\",\"orderId\":\"2c1bcc81-9d16-4473-8549-13302c38f132\",\"orderLineItemId\":\"83a30054-9860-48a4-8952-da76d88d1fda\",\"paymentInstrumentId\":\"lchqggAAAAAFAACA\",\"paymentInstrumentSessionId\":\"77e926f3-1757-4015-95fa-707bfb87fe35\",\"productId\":\"CFQ7TTC0K5DJ\",\"recurrenceGroup\":\"Classic Gold\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"Direct\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"XMR-00001\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2019-12-02T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"000C\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"9f38c124-d3a8-4dd7-9d44-ae7328b8e0c4\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"c2a64109c7444dac9ccaadb759936684\",\"entitlementIds\":[\"c2a64109c7444dac9ccaadb759936684\"],\"eventSequence\":5,\"eventTime\":\"2019-10-24T18:18:07.2526282+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-us\",\"market\":\"US\",\"orderId\":\"2c1bcc81-9d16-4473-8549-13302c38f132\",\"orderLineItemId\":\"83a30054-9860-48a4-8952-da76d88d1fda\",\"paymentInstrumentId\":\"lchqggAAAAAGAACA\",\"paymentInstrumentSessionId\":\"77e926f3-1757-4015-95fa-707bfb87fe35\",\"productId\":\"CFQ7TTC0K5DJ\",\"recurrenceGroup\":\"Classic Gold\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"Direct\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"XMR-00001\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2019-12-02T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"000C\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"96224ee2-7023-448a-8bc5-e807571a8b35\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"c2a64109c7444dac9ccaadb759936684\",\"entitlementIds\":[\"c2a64109c7444dac9ccaadb759936684\"],\"eventSequence\":6,\"eventTime\":\"2019-11-14T21:58:03.1793821+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-us\",\"market\":\"US\",\"orderId\":\"2c1bcc81-9d16-4473-8549-13302c38f132\",\"orderLineItemId\":\"83a30054-9860-48a4-8952-da76d88d1fda\",\"paymentInstrumentId\":\"lchqggAAAAAHAACA\",\"paymentInstrumentSessionId\":\"77e926f3-1757-4015-95fa-707bfb87fe35\",\"productId\":\"CFQ7TTC0K5DJ\",\"recurrenceGroup\":\"Classic Gold\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"Direct\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"XMR-00001\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2019-12-02T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"000C\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"756fa261-b8b3-4806-b4e2-c37baeab051a\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"c2a64109c7444dac9ccaadb759936684\",\"entitlementIds\":[\"c2a64109c7444dac9ccaadb759936684\"],\"eventSequence\":7,\"eventTime\":\"2019-11-14T22:57:43.3328938+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-us\",\"market\":\"US\",\"orderId\":\"2c1bcc81-9d16-4473-8549-13302c38f132\",\"orderLineItemId\":\"83a30054-9860-48a4-8952-da76d88d1fda\",\"paymentInstrumentId\":\"lchqggAAAAAIAACA\",\"paymentInstrumentSessionId\":\"77e926f3-1757-4015-95fa-707bfb87fe35\",\"productId\":\"CFQ7TTC0K5DJ\",\"recurrenceGroup\":\"Classic Gold\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"Direct\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"XMR-00001\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2019-12-02T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"000C\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"24289b75-4fb4-4bb1-a2b7-8f453676d371\"}]},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"count\":1,\"documentVersion\":0,\"entitlementId\":\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\",\"entitlementIds\":[\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\"],\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"id\":\"mdr:1055518870507325:e4e59792df594f0c959cb7ac0ad9f0bd:365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\",\"isMasteredInModern\":true,\"isTrial\":false,\"isWithinResellerRestrictionPeriod\":false,\"language\":\"en-US\",\"lastModified\":\"2019-11-14T22:57:45.6454205+00:00\",\"market\":\"US\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"modernRevenueRecognitionScheduleId\":\"26a02d59-cfe4-492f-b59e-489f7ecd0f98\",\"paymentInstrumentId\":\"lchqggAAAAAIAACA\",\"paymentInstrumentSessionId\":\"34ba717c-f4a1-4351-aae6-b308d4b91e2f\",\"productId\":\"CFQ7TTC0K5DM\",\"purchaser\":\"msa:1055518870507325\",\"recurrenceGroup\":\"Office 365 (Worldwide)\",\"recurrencePolicyId\":\"Monthly\",\"recurrenceState\":\"Active\",\"revenueRecognitionEndDate\":\"2020-01-11T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"007P\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"startTime\":\"2019-10-18T00:00:00+00:00\",\"changeRecords\":[{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"clientContext\":{\"client\":\"UniversalWebStore.Cart\"},\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\",\"entitlementIds\":[\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\"],\"eventSequence\":1,\"eventTime\":\"2019-10-18T01:12:27.1624091+00:00\",\"eventType\":\"Created\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-US\",\"lotId\":100,\"market\":\"US\",\"modernRevenueRecognitionScheduleId\":\"26a02d59-cfe4-492f-b59e-489f7ecd0f98\",\"orderId\":\"365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\",\"orderLineItemId\":\"dc2ddb68-0774-4cf8-b81c-b8111253585b\",\"paymentInstrumentId\":\"lchqggAAAAABAACA\",\"paymentInstrumentSessionId\":\"34ba717c-f4a1-4351-aae6-b308d4b91e2f\",\"productId\":\"CFQ7TTC0K5DM\",\"recurrenceGroup\":\"Office 365 (Worldwide)\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"P2W-00003\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2020-01-11T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"007P\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"e6cdbe96-b6d6-4cfd-baaf-9778a4a62d6b\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\",\"entitlementIds\":[\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\"],\"eventSequence\":2,\"eventTime\":\"2019-10-18T22:41:37.5398358+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-US\",\"market\":\"US\",\"orderId\":\"365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\",\"orderLineItemId\":\"dc2ddb68-0774-4cf8-b81c-b8111253585b\",\"paymentInstrumentId\":\"lchqggAAAAACAACA\",\"paymentInstrumentSessionId\":\"34ba717c-f4a1-4351-aae6-b308d4b91e2f\",\"productId\":\"CFQ7TTC0K5DM\",\"recurrenceGroup\":\"Office 365 (Worldwide)\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"P2W-00003\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2020-01-11T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"007P\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"fc33748a-5aa4-4632-ab40-a6d9bc332c24\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\",\"entitlementIds\":[\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\"],\"eventSequence\":3,\"eventTime\":\"2019-10-18T23:31:46.5136168+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-US\",\"market\":\"US\",\"orderId\":\"365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\",\"orderLineItemId\":\"dc2ddb68-0774-4cf8-b81c-b8111253585b\",\"paymentInstrumentId\":\"lchqggAAAAAEAACA\",\"paymentInstrumentSessionId\":\"34ba717c-f4a1-4351-aae6-b308d4b91e2f\",\"productId\":\"CFQ7TTC0K5DM\",\"recurrenceGroup\":\"Office 365 (Worldwide)\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"P2W-00003\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2020-01-11T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"007P\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"abc8c5a4-2e30-4216-b0cc-040d19f5957c\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\",\"entitlementIds\":[\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\"],\"eventSequence\":4,\"eventTime\":\"2019-10-24T18:13:16.9360644+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-US\",\"market\":\"US\",\"orderId\":\"365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\",\"orderLineItemId\":\"dc2ddb68-0774-4cf8-b81c-b8111253585b\",\"paymentInstrumentId\":\"lchqggAAAAAFAACA\",\"paymentInstrumentSessionId\":\"34ba717c-f4a1-4351-aae6-b308d4b91e2f\",\"productId\":\"CFQ7TTC0K5DM\",\"recurrenceGroup\":\"Office 365 (Worldwide)\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"P2W-00003\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2020-01-11T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"007P\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"40234d79-7d05-4b54-b6c2-5f7041f18ffe\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\",\"entitlementIds\":[\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\"],\"eventSequence\":5,\"eventTime\":\"2019-10-24T18:18:08.6432625+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-US\",\"market\":\"US\",\"orderId\":\"365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\",\"orderLineItemId\":\"dc2ddb68-0774-4cf8-b81c-b8111253585b\",\"paymentInstrumentId\":\"lchqggAAAAAGAACA\",\"paymentInstrumentSessionId\":\"34ba717c-f4a1-4351-aae6-b308d4b91e2f\",\"productId\":\"CFQ7TTC0K5DM\",\"recurrenceGroup\":\"Office 365 (Worldwide)\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"P2W-00003\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2020-01-11T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"007P\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"1d6a2d00-3e36-4976-aeee-5dc8f4264cc5\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\",\"entitlementIds\":[\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\"],\"eventSequence\":6,\"eventTime\":\"2019-11-14T21:58:04.6793861+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-US\",\"market\":\"US\",\"orderId\":\"365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\",\"orderLineItemId\":\"dc2ddb68-0774-4cf8-b81c-b8111253585b\",\"paymentInstrumentId\":\"lchqggAAAAAHAACA\",\"paymentInstrumentSessionId\":\"34ba717c-f4a1-4351-aae6-b308d4b91e2f\",\"productId\":\"CFQ7TTC0K5DM\",\"recurrenceGroup\":\"Office 365 (Worldwide)\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"P2W-00003\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2020-01-11T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"007P\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"b484827f-4350-49e9-8531-4d6ca9901f7f\"},{\"autoRenew\":true,\"beneficiary\":\"msa:1055518870507325\",\"billingDate\":\"2019-11-18T00:00:00+00:00\",\"convertedFrom\":[],\"count\":1,\"entitlementId\":\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\",\"entitlementIds\":[\"e6cdbe96b6d64cfdbaaf9778a4a62d6b\"],\"eventSequence\":7,\"eventTime\":\"2019-11-14T22:57:44.7547727+00:00\",\"eventType\":\"PaymentTermsChanged\",\"expirationTime\":\"2019-11-18T00:00:00+00:00\",\"isTrial\":false,\"language\":\"en-US\",\"market\":\"US\",\"orderId\":\"365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\",\"orderLineItemId\":\"dc2ddb68-0774-4cf8-b81c-b8111253585b\",\"paymentInstrumentId\":\"lchqggAAAAAIAACA\",\"paymentInstrumentSessionId\":\"34ba717c-f4a1-4351-aae6-b308d4b91e2f\",\"productId\":\"CFQ7TTC0K5DM\",\"recurrenceGroup\":\"Office 365 (Worldwide)\",\"recurrencePolicyId\":\"Monthly\",\"reportingStructure\":\"{\\\"CampaignName\\\":\\\"\\\",\\\"CampaignId\\\":\\\"\\\",\\\"ChannelName\\\":\\\"\\\",\\\"ChannelType\\\":\\\"Direct\\\",\\\"Duration\\\":\\\"1\\\",\\\"DurationType\\\":\\\"Month\\\",\\\"PaymentClass\\\":\\\"Full\\\",\\\"RevenueSKU\\\":\\\"P2W-00003\\\",\\\"RecurrenceRevenueSKU\\\":\\\"\\\"}\",\"revenueRecognitionEndDate\":\"2020-01-11T00:00:00+00:00\",\"revenueRecognitionState\":\"Started\",\"skuId\":\"007P\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"trackingId\":\"015b19e5-f7e3-4ee0-ab34-29a1bb89e17d\"}]}]}";
                }
            }
            else if (request.RequestUri.ToString().Contains("Q2ip4n2JqLncYdZAs7Ip71aZd6W0bev8"))
            {
                // For a cartId, respond with 404 NotFound
                var notFoundResponseMessage = new HttpResponseMessage(HttpStatusCode.NotFound)
                {
                    RequestMessage = request,
                    Content = new StringContent(
                     responseContent,
                     System.Text.Encoding.UTF8,
                     "application/json")
                };

                return await Task.FromResult(notFoundResponseMessage);
            }
            else
            {
                if (request.RequestUri.ToString().Contains("orders"))
                {
                    if (trimmedSegments.Length == 6)
                    {
                        // GerOrder
                        var filteredOrder = Orders.FirstOrDefault(x => trimmedSegments[5] == x.OrderId);
                        responseContent = JsonConvert.SerializeObject(filteredOrder);
                    }
                    else
                    {
                        // List Orders
                        responseContent = "{\"items\":[{\"bundlePrices\":[],\"clientContext\":{\"client\":\"UniversalWebStore.Cart\",\"deviceId\":\"6966500065365589\",\"deviceType\":\"Unknown\"},\"createdTime\":\"2019-10-18T01:11:34.4875638+00:00\",\"currencyCode\":null,\"displayTotalFeeAmount\":null,\"friendlyName\":\"cart-save-for-later-US\",\"isInManualReview\":false,\"isPIRequired\":false,\"RequiresPIValidation\":\"NotRequired\",\"isUpdatePIAllowed\":false,\"language\":\"en-US\",\"manualReviewRiskDecision\":\"None\",\"market\":\"US\",\"omniChannelFulfillmentId\":\"\",\"orderAdditionalMetadata\":\"{}\",\"orderId\":\"007b3d5d-18a1-4ce8-a2f7-57a8d89c4336\",\"orderLineItems\":[],\"orderState\":\"Editing\",\"orderValidityEndTime\":\"2019-10-19T01:11:34.4875638+00:00\",\"orderValidityStartTime\":\"2019-10-18T01:11:34.4875638+00:00\",\"promoCodes\":[],\"purchaser\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"riskSessionId\":\"90d00e75-6bc6-4d6f-bea4-b9c99a4e1b13\",\"shortOrderId\":\"3611975540\",\"taxDetails\":[],\"testScenarios\":\"TestUser\",\"totalAmount\":0.0,\"totalAmountBeforeTax\":0.0,\"totalAmusementTax\":0.0,\"totalChargedToCsvTopOffPI\":0.0,\"totalItemAmount\":0.0,\"totalSalesTax\":0.0,\"totalTaxAmount\":0.0,\"version\":\"7.0\"},{\"billingInformation\":{\"billingRecordId\":\"17c63d81-472d-40f4-b8bb-f614ca890cbd\",\"billingRecordVersion\":0,\"paymentInstrumentId\":\"lchqggAAAAABAACA\",\"sessionId\":\"77e926f3-1757-4015-95fa-707bfb87fe35\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"taxInfoReference\":\"00000000-0000-0000-0000-000000000000\",\"tokenizedPaymentInstrumentData\":\"\"},\"bundlePrices\":[],\"clientContext\":{\"client\":\"UniversalWebStore\",\"deviceFamily\":\"Web\",\"deviceId\":\"6966500065365589\",\"deviceType\":\"Unknown\"},\"createdTime\":\"2019-10-18T01:09:43.3804258+00:00\",\"currencyCode\":\"USD\",\"displayTotalFeeAmount\":0.0,\"isInManualReview\":false,\"isPIRequired\":true,\"RequiresPIValidation\":\"NotRequired\",\"isUpdatePIAllowed\":false,\"language\":\"en-us\",\"manualReviewRiskDecision\":\"None\",\"market\":\"US\",\"omniChannelFulfillmentId\":\"\",\"orderId\":\"2c1bcc81-9d16-4473-8549-13302c38f132\",\"orderLineItems\":[{\"availabilityId\":\"CFQ7TTC0J7FM\",\"beneficiary\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"billingState\":\"Charged\",\"currencyCode\":\"USD\",\"description\":\"Xbox Live Gold 1 Month\",\"fulfillmentDate\":\"2019-10-18T01:10:02.1161486+00:00\",\"fulfillmentState\":\"Fulfilled\",\"isPIRequired\":true,\"isTaxIncluded\":false,\"lineItemId\":\"83a30054-9860-48a4-8952-da76d88d1fda\",\"listPrice\":9.99,\"fulfillmentStates\":[{\"cancelable\":true,\"canceled\":false,\"fulfillmentQuantityId\":\"27ae8af2-caae-4551-85b3-fe8564d8a7c1\",\"fulfillmentReturnType\":0,\"fulfillmentState\":\"Fulfilled\",\"refundJustifications\":[]}],\"billingStates\":[{\"startIndex\":0,\"endIndex\":0,\"billingState\":\"Charged\",\"totalChargedAmount\":10.99,\"totalRefundedAmount\":0.0,\"totalRefundedTaxAmount\":0.0,\"totalRefundedFeeAmount\":0.0,\"totalRefundedFeeTaxAmount\":0.0}],\"fulfillmentBillingStates\":[{\"billingState\":\"Charged\",\"count\":1,\"fulfillmentState\":\"Fulfilled\"}],\"parentalApprovalState\":\"None\",\"payments\":[{\"paymentInstrumentId\":\"lchqggAAAAABAACA\",\"chargedAmount\":10.99}],\"productId\":\"CFQ7TTC0K5DJ\",\"productReturnCategorization\":\"App.Purchase\",\"productType\":\"PASS\",\"quantity\":1,\"retailPrice\":9.99,\"shipToAddressId\":\"\",\"skuId\":\"000C\",\"taxAmount\":1.00,\"taxType\":\"TaxesNotIncluded\",\"title\":\"Xbox Live Gold 1 Month\",\"totalAmount\":10.99,\"recurrenceId\":\"mdr:1055518870507325:1277730306f34c3998bbc89b759e95a5:2c1bcc81-9d16-4473-8549-13302c38f132\"}],\"orderPlacedDate\":\"2019-10-18T01:10:02.4130199+00:00\",\"orderState\":\"Purchased\",\"orderValidityEndTime\":\"2019-10-19T01:09:43.3804258+00:00\",\"orderValidityStartTime\":\"2019-10-18T01:09:43.3804258+00:00\",\"promoCodes\":[],\"purchaser\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"shortOrderId\":\"4347142026\",\"taxDetails\":[{\"jurisdiction\":\"WASHINGTON\",\"taxAmount\":0.65,\"taxType\":\"Retail Sales and Use Tax\"},{\"jurisdiction\":\"KING\",\"taxAmount\":0.0,\"taxType\":\"Local Sales and Use Tax\"},{\"jurisdiction\":\"REDMOND\",\"taxAmount\":0.21,\"taxType\":\"Local Sales and Use Tax\"},{\"jurisdiction\":\"REGIONAL TRANSIT AUTHORITY\",\"taxAmount\":0.14,\"taxType\":\"Local Sales and Use Tax\"}],\"testScenarios\":\"TestUser\",\"totalAmount\":10.99,\"totalAmountBeforeTax\":9.99,\"totalAmusementTax\":0.0,\"totalChargedToCsvTopOffPI\":0.0,\"totalDeliveryPriceAmount\":0.0,\"totalDeliveryPriceTaxAmount\":0.0,\"totalFeeAmount\":0.0,\"totalItemAmount\":9.99,\"totalSalesTax\":1.00,\"totalTaxAmount\":1.00,\"version\":\"7.0\"},{\"billingInformation\":{\"billingRecordId\":\"40ad3641-c4e3-4687-b1be-83e1797be95f\",\"billingRecordVersion\":0,\"paymentInstrumentId\":\"lchqggAAAAABAACA\",\"sessionId\":\"34ba717c-f4a1-4351-aae6-b308d4b91e2f\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"taxInfoReference\":\"00000000-0000-0000-0000-000000000000\",\"tokenizedPaymentInstrumentData\":\"\"},\"bundlePrices\":[],\"clientContext\":{\"client\":\"UniversalWebStore.Cart\",\"deviceId\":\"6966500065365589\",\"deviceType\":\"Unknown\"},\"createdTime\":\"2019-10-18T01:11:31.2658115+00:00\",\"currencyCode\":\"USD\",\"displayTotalFeeAmount\":0.0,\"friendlyName\":\"cart-US\",\"isInManualReview\":false,\"isPIRequired\":true,\"RequiresPIValidation\":\"NotRequired\",\"isUpdatePIAllowed\":false,\"language\":\"en-US\",\"manualReviewRiskDecision\":\"None\",\"market\":\"US\",\"omniChannelFulfillmentId\":\"\",\"orderAdditionalMetadata\":\"{}\",\"orderId\":\"365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\",\"orderLineItems\":[{\"availabilityId\":\"CFQ7TTBZX6SV\",\"beneficiary\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"billingState\":\"Charged\",\"currencyCode\":\"USD\",\"description\":\"Office 365 Home\",\"fulfillmentDate\":\"2019-10-18T01:12:27.1624091+00:00\",\"fulfillmentState\":\"Fulfilled\",\"isPIRequired\":true,\"isTaxIncluded\":false,\"lineItemId\":\"dc2ddb68-0774-4cf8-b81c-b8111253585b\",\"listPrice\":9.99,\"fulfillmentStates\":[{\"cancelable\":true,\"canceled\":false,\"fulfillmentQuantityId\":\"aab4a299-0ad6-4fad-b5fe-9443f108b585\",\"fulfillmentReturnType\":0,\"fulfillmentState\":\"Fulfilled\",\"refundJustifications\":[]}],\"billingStates\":[{\"startIndex\":0,\"endIndex\":0,\"billingState\":\"Charged\",\"totalChargedAmount\":10.99,\"totalRefundedAmount\":0.0,\"totalRefundedTaxAmount\":0.0,\"totalRefundedFeeAmount\":0.0,\"totalRefundedFeeTaxAmount\":0.0}],\"fulfillmentBillingStates\":[{\"billingState\":\"Charged\",\"count\":1,\"fulfillmentState\":\"Fulfilled\"}],\"parentalApprovalState\":\"None\",\"payments\":[{\"paymentInstrumentId\":\"lchqggAAAAABAACA\",\"chargedAmount\":10.99}],\"productId\":\"CFQ7TTC0K5DM\",\"productReturnCategorization\":\"App.Purchase\",\"productType\":\"PASS\",\"quantity\":1,\"retailPrice\":9.99,\"shipToAddressId\":\"\",\"skuId\":\"007P\",\"taxAmount\":1.00,\"taxType\":\"TaxesNotIncluded\",\"title\":\"Office 365 Home\",\"totalAmount\":10.99,\"recurrenceId\":\"mdr:1055518870507325:e4e59792df594f0c959cb7ac0ad9f0bd:365bf870-ad8d-44e7-a0d6-2d94c6dbb93e\"}],\"orderPlacedDate\":\"2019-10-18T01:12:27.4436338+00:00\",\"orderState\":\"Purchased\",\"orderValidityEndTime\":\"2019-10-19T01:11:31.2658115+00:00\",\"orderValidityStartTime\":\"2019-10-18T01:11:31.2658115+00:00\",\"promoCodes\":[],\"purchaser\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"riskSessionId\":\"90d00e75-6bc6-4d6f-bea4-b9c99a4e1b13\",\"shortOrderId\":\"3629174985\",\"taxDetails\":[{\"jurisdiction\":\"WASHINGTON\",\"taxAmount\":0.65,\"taxType\":\"Retail Sales and Use Tax\"},{\"jurisdiction\":\"KING\",\"taxAmount\":0.0,\"taxType\":\"Local Sales and Use Tax\"},{\"jurisdiction\":\"REDMOND\",\"taxAmount\":0.21,\"taxType\":\"Local Sales and Use Tax\"},{\"jurisdiction\":\"REGIONAL TRANSIT AUTHORITY\",\"taxAmount\":0.14,\"taxType\":\"Local Sales and Use Tax\"}],\"testScenarios\":\"TestUser\",\"totalAmount\":10.99,\"totalAmountBeforeTax\":9.99,\"totalAmusementTax\":0.0,\"totalChargedToCsvTopOffPI\":0.0,\"totalDeliveryPriceAmount\":0.0,\"totalDeliveryPriceTaxAmount\":0.0,\"totalFeeAmount\":0.0,\"totalItemAmount\":9.99,\"totalSalesTax\":1.00,\"totalTaxAmount\":1.00,\"version\":\"7.0\"},{\"billingInformation\":{\"billingRecordId\":\"feb03acb-243d-42ac-832a-231466d34eac\",\"billingRecordVersion\":0,\"paymentInstrumentId\":\"lchqggAAAAAHAACA\",\"sessionId\":\"e9e0d911-603d-469d-a69f-32f0a2151699\",\"soldToAddressId\":\"3012ec80-7028-5b43-d356-8f8bbac1b83f\",\"taxInfoReference\":\"00000000-0000-0000-0000-000000000000\",\"tokenizedPaymentInstrumentData\":\"\"},\"bundlePrices\":[],\"clientContext\":{\"client\":\"Universal Store Native Client\",\"deviceFamily\":\"Windows.Desktop\",\"deviceId\":\"6825768918790850\",\"deviceType\":\"Unknown\"},\"createdTime\":\"2019-11-14T22:07:02.7388215+00:00\",\"currencyCode\":\"USD\",\"displayTotalFeeAmount\":0.0,\"isInManualReview\":false,\"isPIRequired\":true,\"RequiresPIValidation\":\"NotRequired\",\"isUpdatePIAllowed\":false,\"language\":\"en-US,zh-Hans-CN\",\"manualReviewRiskDecision\":\"None\",\"market\":\"US\",\"omniChannelFulfillmentId\":\"\",\"orderId\":\"f5598585-7340-4c5b-b41e-3df950c4925e\",\"orderLineItems\":[{\"availabilityId\":\"9SRH01VQWHM7\",\"beneficiary\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"billingState\":\"Charged\",\"campaignId\":\"\",\"currencyCode\":\"USD\",\"description\":\"Riptide GP™2 kicks everything into overdrive, with intense dynamic water racing, upgradeable hydro jets and riders, improved graphics, an all-new career mode, and a whole new stunt system with dozens of new tricks!  \\r\\n\\r\\nFeaturing rocket-powered hydro jets racing around futuristic tracks across a dynamic and interactive water surface, Riptide GP2 delivers a fast, fun, and visually stunning racing experience.\\r\\n\\r\\nFrom Vector Unit, developers of acclaimed racing games Riptide GP and Hydro Thunder Hurricane.\",\"devOfferId\":\"\",\"fulfillmentDate\":\"2019-11-14T22:07:12.0200785+00:00\",\"fulfillmentState\":\"Fulfilled\",\"isPIRequired\":true,\"isTaxIncluded\":false,\"lineItemId\":\"16bd31de-d49a-41c2-aa95-9de6d8117082\",\"listPrice\":2.99,\"optionalCampaignId\":\"ems.dco.storespotlight\",\"fulfillmentStates\":[{\"cancelable\":true,\"canceled\":false,\"fulfillmentQuantityId\":\"f939712d-a354-4101-ad7c-e606aaaab647\",\"fulfillmentReturnType\":0,\"fulfillmentState\":\"Fulfilled\",\"refundJustifications\":[]}],\"billingStates\":[{\"startIndex\":0,\"endIndex\":0,\"billingState\":\"Charged\",\"totalChargedAmount\":3.28,\"totalRefundedAmount\":0.0,\"totalRefundedTaxAmount\":0.0,\"totalRefundedFeeAmount\":0.0,\"totalRefundedFeeTaxAmount\":0.0}],\"fulfillmentBillingStates\":[{\"billingState\":\"Charged\",\"count\":1,\"fulfillmentState\":\"Fulfilled\"}],\"parentalApprovalState\":\"None\",\"payments\":[{\"paymentInstrumentId\":\"lchqggAAAAAHAACA\",\"chargedAmount\":3.28}],\"productId\":\"9WZDNCRFJ9Z1\",\"productReturnCategorization\":\"App.Purchase\",\"productType\":\"Game\",\"quantity\":1,\"retailPrice\":2.99,\"shipToAddressId\":\"\",\"skuId\":\"0010\",\"taxAmount\":0.29,\"taxType\":\"TaxesNotIncluded\",\"title\":\"Riptide GP2\",\"totalAmount\":3.28}],\"orderPlacedDate\":\"2019-11-14T22:07:12.0200785+00:00\",\"orderState\":\"Purchased\",\"orderValidityEndTime\":\"2019-11-15T22:07:02.7388215+00:00\",\"orderValidityStartTime\":\"2019-11-14T22:07:02.7388215+00:00\",\"promoCodes\":[],\"purchaser\":{\"identityType\":\"Msa\",\"identityValue\":\"1055518870507325\"},\"shortOrderId\":\"4532524856\",\"taxDetails\":[{\"jurisdiction\":\"WASHINGTON\",\"taxAmount\":0.19,\"taxType\":\"Retail Sales and Use Tax\"},{\"jurisdiction\":\"KING\",\"taxAmount\":0.0,\"taxType\":\"Local Sales and Use Tax\"},{\"jurisdiction\":\"REDMOND\",\"taxAmount\":0.06,\"taxType\":\"Local Sales and Use Tax\"},{\"jurisdiction\":\"REGIONAL TRANSIT AUTHORITY\",\"taxAmount\":0.04,\"taxType\":\"Local Sales and Use Tax\"}],\"testScenarios\":\"TestUser\",\"totalAmount\":3.28,\"totalAmountBeforeTax\":2.99,\"totalAmusementTax\":0.0,\"totalChargedToCsvTopOffPI\":0.0,\"totalDeliveryPriceAmount\":0.0,\"totalDeliveryPriceTaxAmount\":0.0,\"totalFeeAmount\":0.0,\"totalItemAmount\":2.99,\"totalSalesTax\":0.29,\"totalTaxAmount\":0.29,\"version\":\"7.0\"}]}";
                    }
                }
            }

            var responseMessage = new HttpResponseMessage(statusCode)
            {
                RequestMessage = request,
                Content = new StringContent(
                    responseContent,
                    System.Text.Encoding.UTF8,
                    "application/json")
            };
            
            if (string.IsNullOrEmpty(responseContent))
            {
                return null;
            }

            return await Task.FromResult(responseMessage);
        }

        private static string GetNextLink(System.Uri requestUri, string continuationToken)
        {
            if (string.IsNullOrWhiteSpace(continuationToken))
            {
                return null;
            }

            var queryParameters = Microsoft.AspNetCore.WebUtilities.QueryHelpers.ParseQuery(requestUri.Query);
            queryParameters["continuationToken"] = continuationToken;

            var newQuery = string.Join("&", queryParameters.SelectMany(kvp => kvp.Value.Select(v => $"{kvp.Key}={System.Uri.EscapeDataString(v)}")));
            var uriBuilder = new System.UriBuilder(requestUri) { Query = newQuery };
            return uriBuilder.Uri.ToString();
        }

        private static PaymentInstrumentCheckResponse GetCheckPIResult(string[] trimmedSegments)
        {
            var filteredCheckPiResult = MockCheckPiResults.FirstOrDefault(x => trimmedSegments[5] == x.PaymentInstrumentId)?.GetPaymentInstrumentCheckResponse();
            if (filteredCheckPiResult == null)
            {
                filteredCheckPiResult = new PaymentInstrumentCheckResponse()
                {
                    OrderIds = new List<string>(),
                    RecurrenceIds = new List<string>(),
                    PaymentInstrumentInUse = false,
                };
            }

            return filteredCheckPiResult;
        }
    }
}